<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ğŸ”¥ æˆ¦ç•¥å¸ä»¤å¡”</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body class="bg-gradient-to-br from-slate-900 via-purple-900 to-slate-900 min-h-screen text-white">
  <div class="container mx-auto p-4 sm:p-8 max-w-7xl">
    <!-- ãƒ˜ãƒƒãƒ€ãƒ¼ -->
    <div class="flex items-center justify-between mb-8">
      <div>
        <h1 class="text-5xl font-bold bg-gradient-to-r from-yellow-400 via-red-500 to-pink-500 bg-clip-text text-transparent">ğŸ”¥ æˆ¦ç•¥å¸ä»¤å¡”</h1>
        <p class="text-gray-300 mt-2">è¿·ã‚ãšåˆ¤æ–­ã™ã‚‹ãŸã‚ã®å¸ä»¤å¡”</p>
      </div>
      <div class="flex gap-2">
        <a href="index.html" class="px-4 py-2 bg-gradient-to-r from-purple-600 to-purple-700 text-white rounded-xl hover:from-purple-700 hover:to-purple-800 transition shadow-lg font-bold">ğŸ¯ ãƒ¡ã‚¤ãƒ³</a>
      </div>
    </div>

    <!-- ğŸ’¡ ä»Šæ—¥ã®çµè«–ãƒœãƒƒã‚¯ã‚¹ -->
    <div id="conclusionBox" class="mb-8 p-8 rounded-2xl shadow-2xl border-4">
      <div class="flex items-center gap-6">
        <div id="conclusionEmoji" class="text-8xl">ğŸŸ¢</div>
        <div class="flex-1">
          <h2 class="text-3xl font-bold mb-2" id="conclusionTitle">ä»Šæ—¥ã®çµè«–ï¼šæ–°è¦ãƒˆãƒ¬ãƒ¼ãƒ‰OK</h2>
          <p class="text-xl text-gray-300 mb-3" id="conclusionReason">ç†ç”±ï¼šæœŸå¾…å€¤ãƒ—ãƒ©ã‚¹ãƒ»å®‰å®šç¨¼åƒä¸­</p>
          <p class="text-lg font-bold" id="conclusionAction">ğŸ‘‰ è¡Œå‹•ï¼šç¶™ç¶šå¯</p>
        </div>
      </div>
    </div>

    <!-- ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼ï¼ˆæœŸé–“é¸æŠï¼‰ -->
    <div class="flex gap-4 mb-8">
      <button onclick="setPeriod('month')" id="btn-month" class="px-6 py-3 bg-slate-800 border-2 border-yellow-500 rounded-xl hover:bg-slate-700 font-bold transition text-white">ä»Šæœˆ</button>
      <button onclick="setPeriod('year')" id="btn-year" class="px-6 py-3 bg-slate-800 border-2 border-yellow-500 rounded-xl hover:bg-slate-700 font-bold transition text-white">ä»Šå¹´</button>
      <button onclick="setPeriod('all')" id="btn-all" class="px-6 py-3 bg-gradient-to-r from-yellow-500 to-red-500 text-white rounded-xl shadow-lg font-bold">å…¨æœŸé–“</button>
    </div>

    <!-- ğŸ§  ã‚»ã‚¯ã‚·ãƒ§ãƒ³1ï¼šç¾åœ¨åœ°ã‚µãƒãƒªãƒ¼ -->
    <div class="mb-8">
      <h2 class="text-3xl font-bold mb-4 text-yellow-400">ğŸ§  ç¾åœ¨åœ°ã‚µãƒãƒªãƒ¼</h2>
      <div class="grid grid-cols-2 md:grid-cols-4 gap-4">
        <!-- æœŸå¾…å€¤ï¼ˆæœ€å„ªå…ˆï¼‰ -->
        <div id="card-expectancy" class="bg-slate-800 p-6 rounded-2xl shadow-xl border-2 border-slate-700 relative">
          <p class="text-sm text-gray-400 mb-1">æœŸå¾…å€¤ï¼ˆå¹³å‡æç›Šï¼‰</p>
          <p id="expectancy" class="text-3xl font-bold">Â¥0</p>
          <p id="expectancyLabel" class="text-sm font-bold mt-2">è©•ä¾¡ä¸­...</p>
          <!-- ãƒŸãƒ‹ãƒãƒ£ãƒ¼ãƒˆ -->
          <div class="mt-3">
            <svg id="sparkline-expectancy" width="100%" height="30" class="opacity-60"></svg>
          </div>
          <p class="text-xs text-gray-500 mt-2">1å›ã®å–å¼•ã§å¹³å‡ã„ãã‚‰å„²ã‹ã‚‹ã‹ï¼ˆãƒã‚¤ãƒŠã‚¹ãªã‚‰æï¼‰ã€‚ãƒ—ãƒ©ã‚¹ãªã‚‰ç¶™ç¶šã€ãƒã‚¤ãƒŠã‚¹ãªã‚‰åœæ­¢æ¤œè¨ã€‚</p>
        </div>
        <!-- ãƒªã‚«ãƒãƒªãƒ¼F -->
        <div id="card-recoveryFactor" class="bg-slate-800 p-6 rounded-2xl shadow-xl border-2 border-slate-700">
          <p class="text-sm text-gray-400 mb-1">ãƒªã‚«ãƒãƒªãƒ¼F</p>
          <p id="recoveryFactor" class="text-3xl font-bold">0.0</p>
          <p id="recoveryLabel" class="text-sm font-bold mt-2">è©•ä¾¡ä¸­...</p>
          <!-- ãƒŸãƒ‹ãƒãƒ£ãƒ¼ãƒˆ -->
          <div class="mt-3">
            <svg id="sparkline-recoveryFactor" width="100%" height="30" class="opacity-60"></svg>
          </div>
          <p class="text-xs text-gray-500 mt-2">ç·æç›ŠÃ·æœ€å¤§DDã€‚DDã‹ã‚‰å›å¾©ã™ã‚‹åŠ›ã€‚2.0ä»¥ä¸ŠãŒç†æƒ³ã€1.0æœªæº€ã¯å±é™ºã€‚</p>
        </div>
        <!-- æœ€å¤§DD -->
        <div id="card-maxDD" class="bg-slate-800 p-6 rounded-2xl shadow-xl border-2 border-slate-700">
          <p class="text-sm text-gray-400 mb-1">æœ€å¤§DD</p>
          <p id="maxDD" class="text-3xl font-bold">Â¥0</p>
          <p id="maxDDLabel" class="text-sm font-bold mt-2">è©•ä¾¡ä¸­...</p>
          <!-- ãƒŸãƒ‹ãƒãƒ£ãƒ¼ãƒˆ -->
          <div class="mt-3">
            <svg id="sparkline-maxDD" width="100%" height="30" class="opacity-60"></svg>
          </div>
          <p class="text-xs text-gray-500 mt-2">ãƒ‰ãƒ­ãƒ¼ãƒ€ã‚¦ãƒ³ï¼šç´¯ç©æç›Šã®æœ€é«˜å€¤ã‹ã‚‰ã®æœ€å¤§ä¸‹è½å¹…ã€‚ç²¾ç¥çš„ãƒ»è³‡é‡‘çš„ãƒ€ãƒ¡ãƒ¼ã‚¸ã®å¤§ãã•ã€‚</p>
        </div>
        <!-- ãƒ—ãƒ­ãƒ•ã‚£ãƒƒãƒˆF -->
        <div id="card-profitFactor" class="bg-slate-800 p-6 rounded-2xl shadow-xl border-2 border-slate-700">
          <p class="text-sm text-gray-400 mb-1">ãƒ—ãƒ­ãƒ•ã‚£ãƒƒãƒˆF</p>
          <p id="profitFactor" class="text-3xl font-bold">0.0</p>
          <p id="profitLabel" class="text-sm font-bold mt-2">è©•ä¾¡ä¸­...</p>
          <!-- ãƒŸãƒ‹ãƒãƒ£ãƒ¼ãƒˆ -->
          <div class="mt-3">
            <svg id="sparkline-profitFactor" width="100%" height="30" class="opacity-60"></svg>
          </div>
          <p class="text-xs text-gray-500 mt-2">ç·åˆ©ç›ŠÃ·ç·æå¤±ã€‚1.0ä»¥ä¸Šã§é»’å­—ã€1.5ä»¥ä¸ŠãŒç†æƒ³ã€‚æå¤±ã«å¯¾ã—ã¦ã©ã‚Œã ã‘åˆ©ç›Šã‚’å‡ºã›ã¦ã„ã‚‹ã‹ã€‚</p>
        </div>
        <!-- å‹ç‡ -->
        <div id="card-winRate" class="bg-slate-800 p-6 rounded-2xl shadow-xl border-2 border-slate-700">
          <p class="text-sm text-gray-400 mb-1">å‹ç‡</p>
          <p id="winRate" class="text-3xl font-bold">0%</p>
          <p id="winRateLabel" class="text-sm font-bold mt-2">è©•ä¾¡ä¸­...</p>
          <!-- ãƒŸãƒ‹ãƒãƒ£ãƒ¼ãƒˆ -->
          <div class="mt-3">
            <svg id="sparkline-winRate" width="100%" height="30" class="opacity-60"></svg>
          </div>
          <p class="text-xs text-gray-500 mt-2">ãƒ—ãƒ©ã‚¹å–å¼•ã®å‰²åˆã€‚50%ä»¥ä¸ŠãŒç›®å®‰ã€‚ãŸã ã—æœŸå¾…å€¤ã®æ–¹ãŒé‡è¦ã€‚</p>
        </div>
        <!-- æœ€å¤§é€£æ•— -->
        <div id="card-maxLoseStreak" class="bg-slate-800 p-6 rounded-2xl shadow-xl border-2 border-slate-700">
          <p class="text-sm text-gray-400 mb-1">æœ€å¤§é€£æ•—</p>
          <p id="maxLoseStreak" class="text-3xl font-bold">0å›</p>
          <p id="loseStreakLabel" class="text-sm font-bold mt-2">è©•ä¾¡ä¸­...</p>
          <!-- ãƒŸãƒ‹ãƒãƒ£ãƒ¼ãƒˆ -->
          <div class="mt-3">
            <svg id="sparkline-maxLoseStreak" width="100%" height="30" class="opacity-60"></svg>
          </div>
          <p class="text-xs text-gray-500 mt-2">è² ã‘ãŒé€£ç¶šã—ãŸæœ€å¤§å›æ•°ã€‚ç²¾ç¥çš„è² æ‹…ã¨DDæ‹¡å¤§ã®ãƒªã‚¹ã‚¯æŒ‡æ¨™ã€‚10å›ä»¥å†…ãŒæœ›ã¾ã—ã„ã€‚</p>
        </div>
        <!-- æœˆæ¬¡æç›ŠSD -->
        <div id="card-stability" class="bg-slate-800 p-6 rounded-2xl shadow-xl border-2 border-slate-700">
          <p class="text-sm text-gray-400 mb-1">æœˆæ¬¡æç›ŠSD</p>
          <p id="stability" class="text-3xl font-bold">Â¥0</p>
          <p id="stabilityLabel" class="text-sm font-bold mt-2">è©•ä¾¡ä¸­...</p>
          <!-- ãƒŸãƒ‹ãƒãƒ£ãƒ¼ãƒˆ -->
          <div class="mt-3">
            <svg id="sparkline-stability" width="100%" height="30" class="opacity-60"></svg>
          </div>
          <p class="text-xs text-gray-500 mt-2">æ¨™æº–åå·®ï¼šæœˆã”ã¨ã®æç›Šã®ãƒ–ãƒ¬å¹…ã€‚å°ã•ã„ã»ã©å®‰å®šã€‚å¤§ãã„ã¨æµ®ãæ²ˆã¿ãŒæ¿€ã—ã„ã€‚</p>
        </div>
        <!-- ç·æç›Š -->
        <div id="card-totalPnL" class="bg-slate-800 p-6 rounded-2xl shadow-xl border-2 border-slate-700">
          <p class="text-sm text-gray-400 mb-1">ç·æç›Š</p>
          <p id="totalPnL" class="text-3xl font-bold">Â¥0</p>
          <p id="totalPnLUSDT" class="text-xl font-bold text-cyan-300 mt-1"></p>
          <!-- ãƒŸãƒ‹ãƒãƒ£ãƒ¼ãƒˆ -->
          <div class="mt-3">
            <svg id="sparkline-totalPnL" width="100%" height="30" class="opacity-60"></svg>
          </div>
          <p class="text-xs text-gray-500 mt-2">å…¨å–å¼•ã®æç›Šåˆè¨ˆã€‚å‚è€ƒå€¤ã€‚æœŸå¾…å€¤ã‚„å®‰å®šæ€§ã®æ–¹ãŒé‡è¦ã€‚</p>
        </div>
      </div>
      
      <!-- ğŸ’¡ ç›´è¿‘ãƒˆãƒ¬ãƒ³ãƒ‰ï¼ˆãƒŸãƒ‹ã‚«ãƒ¼ãƒ‰ï¼‰ -->
      <div class="mt-6 p-4 bg-gradient-to-r from-purple-900 to-blue-900 rounded-2xl shadow-xl border-2 border-purple-500">
        <h3 class="text-xl font-bold mb-3 text-purple-300">ğŸ’¡ ç›´è¿‘ãƒˆãƒ¬ãƒ³ãƒ‰ï¼ˆä»Šã®åˆ¤æ–­ç”¨ï¼‰</h3>
        <div class="grid grid-cols-2 md:grid-cols-4 gap-3">
          <div class="bg-slate-800 p-3 rounded-xl">
            <p class="text-xs text-gray-400 mb-1">ç›´è¿‘30ä»¶ æœŸå¾…å€¤</p>
            <p id="recent30Expectancy" class="text-xl font-bold">Â¥0</p>
            <p id="recent30Label" class="text-xs font-bold mt-1">è©•ä¾¡ä¸­...</p>
          </div>
          <div class="bg-slate-800 p-3 rounded-xl">
            <p class="text-xs text-gray-400 mb-1">ç›´è¿‘100ä»¶ æœŸå¾…å€¤</p>
            <p id="recent100Expectancy" class="text-xl font-bold">Â¥0</p>
            <p id="recent100Label" class="text-xs font-bold mt-1">è©•ä¾¡ä¸­...</p>
          </div>
          <div class="bg-slate-800 p-3 rounded-xl">
            <p class="text-xs text-gray-400 mb-1">ç›´è¿‘30ä»¶ å‹ç‡</p>
            <p id="recent30WinRate" class="text-xl font-bold">0%</p>
          </div>
          <div class="bg-slate-800 p-3 rounded-xl">
            <p class="text-xs text-gray-400 mb-1">ç›´è¿‘100ä»¶ å‹ç‡</p>
            <p id="recent100WinRate" class="text-xl font-bold">0%</p>
          </div>
        </div>
      </div>
    </div>

    <!-- ğŸš¦ ã‚»ã‚¯ã‚·ãƒ§ãƒ³2ï¼šæˆ¦ç•¥ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹è‡ªå‹•åˆ¤å®š -->
    <div class="mb-8">
      <h2 class="text-3xl font-bold mb-4 text-yellow-400">ğŸš¦ æˆ¦ç•¥ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹</h2>
      
      <!-- å…¨ä½“ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ -->
      <div class="mb-4">
        <h3 class="text-xl font-bold mb-2 text-gray-300">å…¨ä½“</h3>
        <div id="strategyStatusOverall" class="bg-slate-800 p-8 rounded-2xl shadow-xl border-4 border-slate-700">
          <div class="flex items-center gap-6">
            <div id="overallEmoji" class="text-7xl">ğŸŸ¢</div>
            <div class="flex-1">
              <div id="overallLabel" class="text-3xl font-bold mb-2 text-green-500">æ­£å¸¸é‹è»¢</div>
              <div id="overallReason" class="text-lg text-gray-300 mb-2">ç†ç”±ï¼šæœŸå¾…å€¤ãƒ—ãƒ©ã‚¹ãƒ»å®‰å®šç¨¼åƒä¸­</div>
              <div id="overallAction" class="text-lg font-bold text-yellow-400">ğŸ‘‰ è¡Œå‹•ï¼šç¶™ç¶šå¯</div>
            </div>
          </div>
        </div>
      </div>

      <!-- âš ï¸ ä¸»çŠ¯ã‚«ãƒ†ã‚´ãƒªè­¦å‘Šã‚«ãƒ¼ãƒ‰ -->
      <div id="culpritWarning" class="mb-4 hidden">
        <h3 class="text-xl font-bold mb-2 text-red-400">âš ï¸ ä¸»çŠ¯ã‚«ãƒ†ã‚´ãƒªæ¤œå‡º</h3>
        <div class="bg-red-900 bg-opacity-30 p-6 rounded-2xl shadow-xl border-4 border-red-500">
          <div id="culpritContent">
            <!-- JavaScriptã§å‹•çš„ç”Ÿæˆ -->
          </div>
        </div>
      </div>

      <!-- ã‚«ãƒ†ã‚´ãƒªåˆ¥ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ -->
      <div>
        <h3 class="text-xl font-bold mb-2 text-gray-300">ã‚«ãƒ†ã‚´ãƒªåˆ¥</h3>
        <div id="strategyStatusByCategory" class="grid grid-cols-3 md:grid-cols-6 lg:grid-cols-8 gap-2">
          <!-- JavaScriptã§å‹•çš„ç”Ÿæˆ -->
        </div>
      </div>
    </div>

    <!-- ğŸ“Š ã‚»ã‚¯ã‚·ãƒ§ãƒ³3ï¼šå‰Šã‚‹ãŸã‚ã®åŸå› åˆ†æ -->
    <div class="mb-8">
      <h2 class="text-3xl font-bold mb-4 text-yellow-400">ğŸ“Š å‰Šã‚‹ãŸã‚ã®åŸå› åˆ†æ</h2>
      
      <!-- ğŸ¯ å‰Šæ¸›ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ -->
      <div class="mb-6 p-6 bg-slate-800 rounded-2xl shadow-xl border-2 border-purple-500">
        <h3 class="text-xl font-bold mb-3 text-purple-400">ğŸ¯ å‰Šæ¸›ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³</h3>
        <p class="text-sm text-gray-400 mb-4">é™¤å¤–ã—ãŸã„ã‚«ãƒ†ã‚´ãƒªã‚’ãƒã‚§ãƒƒã‚¯ã—ã¦ã€å½±éŸ¿ã‚’ç¢ºèªã§ãã¾ã™</p>
        <div id="simulationCheckboxes" class="flex flex-wrap gap-3 mb-4">
          <!-- JavaScriptã§å‹•çš„ç”Ÿæˆ -->
        </div>
        <div id="simulationResult" class="grid grid-cols-3 gap-4 mt-4 hidden">
          <div class="bg-slate-700 p-4 rounded-xl">
            <p class="text-sm text-gray-400">æœŸå¾…å€¤å¤‰åŒ–</p>
            <p id="simExpectancy" class="text-2xl font-bold text-green-400">--</p>
            <p class="text-xs text-gray-500 mt-1">1å›ã®å–å¼•ã®å¹³å‡æç›Š</p>
          </div>
          <div class="bg-slate-700 p-4 rounded-xl">
            <p class="text-sm text-gray-400">æœ€å¤§DDå¤‰åŒ–</p>
            <p id="simMaxDD" class="text-2xl font-bold text-blue-400">--</p>
            <p class="text-xs text-gray-500 mt-1">æœ€å¤§ä¸‹è½å¹…</p>
          </div>
          <div class="bg-slate-700 p-4 rounded-xl">
            <p class="text-sm text-gray-400">ãƒ—ãƒ­ãƒ•ã‚£ãƒƒãƒˆFå¤‰åŒ–</p>
            <p id="simPF" class="text-2xl font-bold text-yellow-400">--</p>
            <p class="text-xs text-gray-500 mt-1">ç·åˆ©ç›ŠÃ·ç·æå¤±ï¼ˆ1.0ä»¥ä¸Šã§é»’å­—ï¼‰</p>
          </div>
        </div>
      </div>
      
      <!-- ã‚¿ãƒ– -->
      <div class="flex gap-2 mb-4">
        <button onclick="setAnalysisTab('category')" id="tab-category" class="px-6 py-3 bg-gradient-to-r from-yellow-500 to-red-500 text-white rounded-xl shadow-lg font-bold">ã‚«ãƒ†ã‚´ãƒªåˆ¥</button>
        <button onclick="setAnalysisTab('symbol')" id="tab-symbol" class="px-6 py-3 bg-slate-800 border-2 border-slate-700 rounded-xl hover:bg-slate-700 font-bold">éŠ˜æŸ„åˆ¥</button>
        <button onclick="setAnalysisTab('broker')" id="tab-broker" class="px-6 py-3 bg-slate-800 border-2 border-slate-700 rounded-xl hover:bg-slate-700 font-bold">è¨¼åˆ¸ä¼šç¤¾åˆ¥</button>
        <button onclick="setAnalysisTab('tradeType')" id="tab-tradeType" class="px-6 py-3 bg-slate-800 border-2 border-slate-700 rounded-xl hover:bg-slate-700 font-bold">å£²è²·å½¢æ…‹åˆ¥</button>
      </div>

      <!-- ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ -->
      <div id="analysisContent" class="bg-slate-800 p-6 rounded-2xl shadow-xl border-2 border-slate-700">
        <div class="overflow-x-auto">
          <table class="w-full text-left">
            <thead class="border-b-2 border-slate-600">
              <tr>
                <th class="px-4 py-3">åå‰</th>
                <th class="px-4 py-3 text-right">ä»¶æ•°</th>
                <th class="px-4 py-3 text-right">ç·æç›Š</th>
                <th class="px-4 py-3 text-right">æœŸå¾…å€¤</th>
                <th class="px-4 py-3 text-right">å‹ç‡</th>
                <th class="px-4 py-3 text-right">æœ€å¤§DD</th>
                <th class="px-4 py-3 text-right">æå¤±å¯„ä¸ç‡</th>
              </tr>
            </thead>
            <tbody id="analysisTableBody"></tbody>
          </table>
        </div>
      </div>
    </div>

    <!-- ğŸ“ˆ ã‚°ãƒ©ãƒ•ã‚»ã‚¯ã‚·ãƒ§ãƒ³ -->
    <div class="grid grid-cols-1 md:grid-cols-2 gap-8 mb-8">
      <!-- æœˆæ¬¡æ¨ç§» -->
      <div class="bg-slate-800 p-6 rounded-2xl shadow-xl border-2 border-slate-700">
        <h3 class="text-2xl font-bold mb-4 text-yellow-400">æœˆæ¬¡æ¨ç§»</h3>
        <canvas id="monthlyChart"></canvas>
      </div>
      <!-- ç´¯ç©æç›Š -->
      <div class="bg-slate-800 p-6 rounded-2xl shadow-xl border-2 border-slate-700">
        <h3 class="text-2xl font-bold mb-4 text-yellow-400">ç´¯ç©æç›Š</h3>
        <canvas id="cumulativeChart"></canvas>
      </div>
    </div>
    
    <!-- ğŸ“‰ ãƒ‰ãƒ­ãƒ¼ãƒ€ã‚¦ãƒ³æ¨ç§»ã‚°ãƒ©ãƒ• -->
    <div class="grid grid-cols-1 md:grid-cols-2 gap-8 mb-8">
      <div class="bg-slate-800 p-6 rounded-2xl shadow-xl border-2 border-red-500">
        <h3 class="text-2xl font-bold mb-2 text-red-400">ğŸ“‰ ãƒ‰ãƒ­ãƒ¼ãƒ€ã‚¦ãƒ³æ¨ç§»</h3>
        <p class="text-sm text-gray-400 mb-4">ç´¯ç©æç›Šã®æœ€é«˜å€¤ã‹ã‚‰ã®ä¸‹è½å¹…ã‚’æ™‚ç³»åˆ—ã§è¡¨ç¤ºã€‚0ã«è¿‘ã„ã»ã©å¥å…¨ã€‚</p>
        <canvas id="drawdownChart"></canvas>
      </div>
      <div class="bg-slate-800 p-6 rounded-2xl shadow-xl border-2 border-slate-700">
        <h3 class="text-2xl font-bold mb-2 text-yellow-400">ğŸ’¡ DDåˆ¤å®šã‚¬ã‚¤ãƒ‰</h3>
        <div class="space-y-3 mt-4">
          <div class="p-3 bg-red-900 bg-opacity-30 rounded-xl border-2 border-red-500">
            <p class="font-bold text-red-400">ğŸ”´ DDæ‹¡å¤§ä¸­</p>
            <p class="text-sm text-gray-300">ä¸‹ã«ä¼¸ã³ç¶šã‘ã¦ã„ã‚‹ â†’ æ–°è¦ãƒˆãƒ¬ãƒ¼ãƒ‰ç¦æ­¢</p>
          </div>
          <div class="p-3 bg-yellow-900 bg-opacity-30 rounded-xl border-2 border-yellow-500">
            <p class="font-bold text-yellow-400">ğŸŸ¡ DDæ¨ªã°ã„ï¼ˆåº•æ‰“ã¡ï¼Ÿï¼‰</p>
            <p class="text-sm text-gray-300">ä¸‹ã’æ­¢ã¾ã‚Š â†’ æ§˜å­è¦‹ã€æ…é‡ã«ç¶™ç¶šæ¤œè¨</p>
          </div>
          <div class="p-3 bg-green-900 bg-opacity-30 rounded-xl border-2 border-green-500">
            <p class="font-bold text-green-400">ğŸŸ¢ DDå›å¾©ä¸­</p>
            <p class="text-sm text-gray-300">0ã«å‘ã‹ã£ã¦ä¸Šæ˜‡ä¸­ â†’ ç¶™ç¶šOK</p>
          </div>
        </div>
      </div>
    </div>
  </div>

  <script>
    const STORAGE_KEY = 'my-finance:pnl_entries:v3';
    let entries = [];
    let currentPeriod = 'all';
    let currentAnalysisTab = 'category';

    // åˆæœŸåŒ–
    function init() {
      loadEntries();
      renderAll();
    }

    // ãƒ‡ãƒ¼ã‚¿èª­ã¿è¾¼ã¿
    function loadEntries() {
      const data = localStorage.getItem(STORAGE_KEY);
      if (data) {
        const parsed = JSON.parse(data);
        entries = Array.isArray(parsed) ? parsed : (parsed.entries || []);
        entries.sort((a, b) => a.date.localeCompare(b.date));
      }
      console.log('ğŸ“Š ãƒ‡ãƒ¼ã‚¿èª­ã¿è¾¼ã¿å®Œäº†:', entries.length, 'ä»¶');
    }

    // æœŸé–“è¨­å®š
    function setPeriod(period) {
      currentPeriod = period;
      ['month', 'year', 'all'].forEach(p => {
        const btn = document.getElementById(`btn-${p}`);
        if (p === period) {
          btn.className = 'px-6 py-3 bg-gradient-to-r from-yellow-500 to-red-500 text-white rounded-xl shadow-lg font-bold';
        } else {
          btn.className = 'px-6 py-3 bg-slate-800 border-2 border-yellow-500 rounded-xl hover:bg-slate-700 font-bold transition text-white';
        }
      });
      renderAll();
    }

    // ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼æ¸ˆã¿ã‚¨ãƒ³ãƒˆãƒªå–å¾—
    function getFilteredEntries() {
      const now = new Date();
      if (currentPeriod === 'month') {
        const startOfMonth = new Date(now.getFullYear(), now.getMonth(), 1).toISOString().split('T')[0];
        return entries.filter(e => e.date >= startOfMonth);
      } else if (currentPeriod === 'year') {
        const startOfYear = new Date(now.getFullYear(), 0, 1).toISOString().split('T')[0];
        return entries.filter(e => e.date >= startOfYear);
      }
      return entries;
    }

    // å…¨ä½“ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°
    function renderAll() {
      renderSummary();
      renderStrategyStatus();
      renderAnalysis();
      renderCharts();
    }

    // ğŸ§  ã‚µãƒãƒªãƒ¼ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°
    function renderSummary() {
      const filtered = getFilteredEntries();
      
      // ç›´è¿‘ãƒˆãƒ¬ãƒ³ãƒ‰è¨ˆç®—ï¼ˆæ–°è¦è¿½åŠ ï¼‰
      renderRecentTrend(filtered);
      
      // åŸºæœ¬æŒ‡æ¨™ï¼ˆJPY/USDTï¼‰
      const totalPnL = filtered.reduce((sum, e) => sum + (e.pnlJPY || 0), 0);
      const totalPnLUSDT = filtered.reduce((sum, e) => sum + (e.pnlUSDT || 0), 0);
      const wins = filtered.filter(e => e.pnlJPY > 0).length;
      const losses = filtered.filter(e => e.pnlJPY < 0).length;
      const winRate = filtered.length > 0 ? (wins / filtered.length) * 100 : 0;
      const expectancy = filtered.length > 0 ? totalPnL / filtered.length : 0;

      // æœ€å¤§DD
      let maxDD = 0;
      let cumulative = 0;
      let peak = 0;
      filtered.forEach(e => {
        cumulative += e.pnlJPY || 0;
        if (cumulative > peak) peak = cumulative;
        const dd = peak - cumulative;
        if (dd > maxDD) maxDD = dd;
      });

      // ãƒªã‚«ãƒãƒªãƒ¼ãƒ•ã‚¡ã‚¯ã‚¿ãƒ¼
      const recoveryFactor = maxDD > 0 ? totalPnL / maxDD : 0;

      // ãƒ—ãƒ­ãƒ•ã‚£ãƒƒãƒˆãƒ•ã‚¡ã‚¯ã‚¿ãƒ¼
      const totalWins = filtered.filter(e => e.pnlJPY > 0).reduce((sum, e) => sum + e.pnlJPY, 0);
      const totalLosses = Math.abs(filtered.filter(e => e.pnlJPY < 0).reduce((sum, e) => sum + e.pnlJPY, 0));
      const profitFactor = totalLosses > 0 ? totalWins / totalLosses : 0;

      // æœ€å¤§é€£æ•—
      let maxLoseStreak = 0;
      let currentStreak = 0;
      filtered.forEach(e => {
        if (e.pnlJPY < 0) {
          currentStreak++;
          if (currentStreak > maxLoseStreak) maxLoseStreak = currentStreak;
        } else {
          currentStreak = 0;
        }
      });

      // æœˆæ¬¡æ¨™æº–åå·®
      const monthlyData = {};
      filtered.forEach(e => {
        const month = e.date.substring(0, 7);
        if (!monthlyData[month]) monthlyData[month] = 0;
        monthlyData[month] += e.pnlJPY || 0;
      });
      const monthlyValues = Object.values(monthlyData);
      const monthlyAvg = monthlyValues.length > 0 ? monthlyValues.reduce((a, b) => a + b, 0) / monthlyValues.length : 0;
      const monthlySD = monthlyValues.length > 0 
        ? Math.sqrt(monthlyValues.reduce((sum, val) => sum + Math.pow(val - monthlyAvg, 2), 0) / monthlyValues.length)
        : 0;

      // è¡¨ç¤ºæ›´æ–°
      document.getElementById('totalPnL').textContent = fmtJPY(totalPnL);
      document.getElementById('totalPnLUSDT').textContent = Number.isFinite(totalPnLUSDT) ? `(${fmtUSDT(totalPnLUSDT)})` : '';
      document.getElementById('winRate').textContent = `${winRate.toFixed(1)}%`;
      document.getElementById('expectancy').textContent = fmtJPY2(Math.round(expectancy));
      document.getElementById('maxDD').textContent = fmtJPY2(Math.round(-maxDD));
      document.getElementById('recoveryFactor').textContent = recoveryFactor.toFixed(2);
      document.getElementById('profitFactor').textContent = profitFactor.toFixed(2);
      document.getElementById('maxLoseStreak').textContent = `${maxLoseStreak}å›`;
      document.getElementById('stability').textContent = fmtJPY2(Math.round(monthlySD));

      // è©•ä¾¡åˆ¤å®šï¼‹ãƒ©ãƒ™ãƒ«è¡¨ç¤ºï¼‹è‰²åˆ†ã‘
      const metrics = [
        { id: 'expectancy', labelId: 'expectancyLabel', value: expectancy, good: expectancy >= 0, label: expectancy >= 0 ? 'âœ… OK' : 'âŒ å±é™º' },
        { id: 'recoveryFactor', labelId: 'recoveryLabel', value: recoveryFactor, good: recoveryFactor >= 2, label: recoveryFactor >= 2 ? 'âœ… OK' : (recoveryFactor >= 1 ? 'âš ï¸ æ³¨æ„' : 'âŒ å±é™º') },
        { id: 'maxDD', labelId: 'maxDDLabel', value: -maxDD, good: maxDD <= Math.abs(totalPnL * 0.3), label: maxDD <= Math.abs(totalPnL * 0.3) ? 'âœ… OK' : 'âš ï¸ æ³¨æ„' },
        { id: 'profitFactor', labelId: 'profitLabel', value: profitFactor, good: profitFactor >= 1.5, label: profitFactor >= 1.5 ? 'âœ… OK' : (profitFactor >= 1.0 ? 'âš ï¸ æ³¨æ„' : 'âŒ å±é™º') },
        { id: 'winRate', labelId: 'winRateLabel', value: winRate, good: winRate >= 50, label: winRate >= 50 ? 'âœ… OK' : 'âš ï¸ æ³¨æ„' },
        { id: 'maxLoseStreak', labelId: 'loseStreakLabel', value: maxLoseStreak, good: maxLoseStreak <= 5, label: maxLoseStreak <= 5 ? 'âœ… OK' : 'âš ï¸ æ³¨æ„' },
        { id: 'stability', labelId: 'stabilityLabel', value: monthlySD, good: monthlySD <= Math.abs(monthlyAvg * 0.5), label: monthlySD <= Math.abs(monthlyAvg * 0.5) ? 'âœ… OK' : 'âš ï¸ æ³¨æ„' }
      ];

      let worstMetric = null;
      metrics.forEach(m => {
        document.getElementById(m.labelId).textContent = m.label;
        document.getElementById(m.labelId).className = `text-sm font-bold mt-2 ${m.good ? 'text-green-400' : 'text-red-400'}`;
        colorizeCard(`card-${m.id}`, m.good);
        if (!m.good && (!worstMetric || !worstMetric.good)) {
          if (!worstMetric || m.id === 'expectancy' || (worstMetric.id !== 'expectancy' && m.id === 'recoveryFactor')) {
            worstMetric = m;
          }
        }
      });

      // æœ€æ‚ªæŒ‡æ¨™ã‚’å¼·èª¿
      if (worstMetric) {
        document.getElementById(`card-${worstMetric.id}`).className = 'bg-slate-800 p-6 rounded-2xl shadow-2xl border-4 border-red-600 animate-pulse';
      }

      // ğŸ’¡ ä»Šæ—¥ã®çµè«–ãƒœãƒƒã‚¯ã‚¹æ›´æ–°
      renderConclusionBox(expectancy, maxDD, totalPnL, profitFactor, maxLoseStreak);
      
      // ğŸ“Š ã‚¹ãƒ‘ãƒ¼ã‚¯ãƒ©ã‚¤ãƒ³æç”»ï¼ˆéå»10æ—¥ãƒˆãƒ¬ãƒ³ãƒ‰ï¼‰
      renderSparklines(filtered);
    }
    
    // ğŸ’¡ ç›´è¿‘ãƒˆãƒ¬ãƒ³ãƒ‰æç”»ï¼ˆæ–°è¦é–¢æ•°ï¼‰
    function renderRecentTrend(filtered) {
      // æ—¥ä»˜é †ã«ä¸¦ã³æ›¿ãˆï¼ˆæ–°ã—ã„é †ï¼‰
      const sorted = [...filtered].sort((a, b) => b.date.localeCompare(a.date));
      
      // ç›´è¿‘30ä»¶
      const recent30 = sorted.slice(0, 30);
      const recent30Total = recent30.reduce((sum, e) => sum + (e.pnlJPY || 0), 0);
      const recent30Expectancy = recent30.length > 0 ? recent30Total / recent30.length : 0;
      const recent30Wins = recent30.filter(e => e.pnlJPY > 0).length;
      const recent30WinRate = recent30.length > 0 ? (recent30Wins / recent30.length) * 100 : 0;
      
      // ç›´è¿‘100ä»¶
      const recent100 = sorted.slice(0, 100);
      const recent100Total = recent100.reduce((sum, e) => sum + (e.pnlJPY || 0), 0);
      const recent100Expectancy = recent100.length > 0 ? recent100Total / recent100.length : 0;
      const recent100Wins = recent100.filter(e => e.pnlJPY > 0).length;
      const recent100WinRate = recent100.length > 0 ? (recent100Wins / recent100.length) * 100 : 0;
      
      // è¡¨ç¤º
      document.getElementById('recent30Expectancy').textContent = fmtJPY2(Math.round(recent30Expectancy));
      document.getElementById('recent30Label').textContent = recent30Expectancy >= 0 ? 'ğŸŸ¢ OK' : 'ğŸ”´ å±é™º';
      document.getElementById('recent30Label').className = `text-xs font-bold mt-1 ${recent30Expectancy >= 0 ? 'text-green-400' : 'text-red-400'}`;
      
      document.getElementById('recent100Expectancy').textContent = fmtJPY2(Math.round(recent100Expectancy));
      document.getElementById('recent100Label').textContent = recent100Expectancy >= 0 ? 'ğŸŸ¢ OK' : 'ğŸ”´ å±é™º';
      document.getElementById('recent100Label').className = `text-xs font-bold mt-1 ${recent100Expectancy >= 0 ? 'text-green-400' : 'text-red-400'}`;
      
      document.getElementById('recent30WinRate').textContent = `${recent30WinRate.toFixed(1)}%`;
      document.getElementById('recent100WinRate').textContent = `${recent100WinRate.toFixed(1)}%`;
    }
    
    // ğŸ“Š ã‚¹ãƒ‘ãƒ¼ã‚¯ãƒ©ã‚¤ãƒ³æç”»ï¼ˆå„ã‚«ãƒ¼ãƒ‰ç”¨ãƒŸãƒ‹ãƒãƒ£ãƒ¼ãƒˆï¼‰
    function renderSparklines(filtered) {
      if (filtered.length === 0) return;
      
      // æ—¥ä»˜ã§ã‚°ãƒ«ãƒ¼ãƒ—åŒ–ï¼ˆç›´è¿‘10æ—¥åˆ†ï¼‰
      const dateGroups = {};
      const sorted = [...filtered].sort((a, b) => b.date.localeCompare(a.date));
      const uniqueDates = [...new Set(sorted.map(e => e.date))].slice(0, 10).reverse(); // å¤ã„é †
      
      uniqueDates.forEach(date => {
        const dayEntries = sorted.filter(e => e.date === date);
        dateGroups[date] = dayEntries;
      });
      
      // å„æŒ‡æ¨™ã”ã¨ã«ã‚¹ãƒ‘ãƒ¼ã‚¯ãƒ©ã‚¤ãƒ³ãƒ‡ãƒ¼ã‚¿ã‚’è¨ˆç®—
      const sparklineData = {
        expectancy: [],
        recoveryFactor: [],
        maxDD: [],
        profitFactor: [],
        winRate: [],
        maxLoseStreak: [],
        stability: [],
        totalPnL: []
      };
      
      let cumulative = 0;
      let peak = 0;
      
      uniqueDates.forEach(date => {
        const dayEntries = dateGroups[date];
        const dayTotal = dayEntries.reduce((sum, e) => sum + (e.pnlJPY || 0), 0);
        const dayExpectancy = dayEntries.length > 0 ? dayTotal / dayEntries.length : 0;
        const dayWins = dayEntries.filter(e => e.pnlJPY > 0).length;
        const dayWinRate = dayEntries.length > 0 ? (dayWins / dayEntries.length) * 100 : 0;
        
        // ç´¯ç©æç›Šæ›´æ–°
        cumulative += dayTotal;
        if (cumulative > peak) peak = cumulative;
        const dd = peak - cumulative;
        
        // ãƒ—ãƒ­ãƒ•ã‚£ãƒƒãƒˆãƒ•ã‚¡ã‚¯ã‚¿ãƒ¼
        const dayTotalWins = dayEntries.filter(e => e.pnlJPY > 0).reduce((sum, e) => sum + e.pnlJPY, 0);
        const dayTotalLosses = Math.abs(dayEntries.filter(e => e.pnlJPY < 0).reduce((sum, e) => sum + e.pnlJPY, 0));
        const dayPF = dayTotalLosses > 0 ? dayTotalWins / dayTotalLosses : 0;
        
        // ãƒªã‚«ãƒãƒªãƒ¼ãƒ•ã‚¡ã‚¯ã‚¿ãƒ¼
        const dayRF = dd > 0 ? cumulative / dd : 0;
        
        // é€£æ•—ã‚«ã‚¦ãƒ³ãƒˆï¼ˆãã®æ—¥ã¾ã§ï¼‰
        let streakCount = 0;
        for (let i = dayEntries.length - 1; i >= 0; i--) {
          if (dayEntries[i].pnlJPY < 0) streakCount++;
          else break;
        }
        
        sparklineData.expectancy.push(dayExpectancy);
        sparklineData.recoveryFactor.push(dayRF);
        sparklineData.maxDD.push(-dd);
        sparklineData.profitFactor.push(dayPF);
        sparklineData.winRate.push(dayWinRate);
        sparklineData.maxLoseStreak.push(streakCount);
        sparklineData.stability.push(dayTotal);
        sparklineData.totalPnL.push(cumulative);
      });
      
      // SVGã‚¹ãƒ‘ãƒ¼ã‚¯ãƒ©ã‚¤ãƒ³æç”»
      drawSparkline('sparkline-expectancy', sparklineData.expectancy);
      drawSparkline('sparkline-recoveryFactor', sparklineData.recoveryFactor);
      drawSparkline('sparkline-maxDD', sparklineData.maxDD);
      drawSparkline('sparkline-profitFactor', sparklineData.profitFactor);
      drawSparkline('sparkline-winRate', sparklineData.winRate);
      drawSparkline('sparkline-maxLoseStreak', sparklineData.maxLoseStreak);
      drawSparkline('sparkline-stability', sparklineData.stability);
      drawSparkline('sparkline-totalPnL', sparklineData.totalPnL);
    }
    
    // SVGã‚¹ãƒ‘ãƒ¼ã‚¯ãƒ©ã‚¤ãƒ³æç”»é–¢æ•°
    function drawSparkline(svgId, data) {
      const svg = document.getElementById(svgId);
      if (!svg || data.length === 0) return;
      
      const width = svg.clientWidth || 200;
      const height = 30;
      const padding = 2;
      
      const minVal = Math.min(...data);
      const maxVal = Math.max(...data);
      const range = maxVal - minVal || 1;
      
      // ãƒã‚¤ãƒ³ãƒˆç”Ÿæˆ
      const points = data.map((val, i) => {
        const x = padding + (i / (data.length - 1 || 1)) * (width - padding * 2);
        const y = height - padding - ((val - minVal) / range) * (height - padding * 2);
        return `${x},${y}`;
      }).join(' ');
      
      // è‰²åˆ¤å®šï¼ˆæœ€å¾Œã®å€¤ãŒæ­£ã‹è² ã‹ï¼‰
      const lastVal = data[data.length - 1];
      const color = lastVal >= 0 ? 'rgba(34, 197, 94, 0.8)' : 'rgba(239, 68, 68, 0.8)';
      
      svg.innerHTML = `
        <polyline 
          points="${points}" 
          fill="none" 
          stroke="${color}" 
          stroke-width="2" 
          stroke-linecap="round" 
          stroke-linejoin="round"
        />
      `;
    }

    // ã‚«ãƒ¼ãƒ‰è‰²åˆ†ã‘
    function colorizeCard(cardId, isGood) {
      const card = document.getElementById(cardId);
      if (isGood) {
        card.className = 'bg-slate-800 p-6 rounded-2xl shadow-xl border-2 border-green-500';
      } else {
        card.className = 'bg-slate-800 p-6 rounded-2xl shadow-xl border-2 border-red-500';
      }
    }

    // ğŸ’¡ ä»Šæ—¥ã®çµè«–ãƒœãƒƒã‚¯ã‚¹æç”»
    function renderConclusionBox(expectancy, maxDD, totalPnL, profitFactor, maxLoseStreak) {
      const box = document.getElementById('conclusionBox');
      const emoji = document.getElementById('conclusionEmoji');
      const title = document.getElementById('conclusionTitle');
      const reason = document.getElementById('conclusionReason');
      const action = document.getElementById('conclusionAction');

      if (expectancy < 0 || (totalPnL < 0 && maxDD > Math.abs(totalPnL * 0.5))) {
        // ğŸ”´ åœæ­¢æ¤œè¨
        box.className = 'mb-8 p-8 rounded-2xl shadow-2xl border-4 border-red-600 bg-red-900 bg-opacity-30';
        emoji.textContent = 'ğŸ”´';
        title.textContent = 'ä»Šæ—¥ã®çµè«–ï¼šæ–°è¦ãƒˆãƒ¬ãƒ¼ãƒ‰ç¦æ­¢';
        reason.textContent = `ç†ç”±ï¼šæœŸå¾…å€¤ãƒã‚¤ãƒŠã‚¹ï¼ˆ${fmtJPY2(Math.round(expectancy))}ï¼‰ï¼æ·±åˆ»ãªDD`;
        action.textContent = 'ğŸ‘‰ è¡Œå‹•ï¼šæ–°è¦ã‚¨ãƒ³ãƒˆãƒªãƒ¼ç¦æ­¢ï¼å¯¾è±¡å‰Šæ¸›ã‚’æ¤œè¨';
      } else if (expectancy > 0 && (maxLoseStreak > 5 || maxDD > Math.abs(totalPnL * 0.3))) {
        // ğŸŸ¡ æ³¨æ„
        box.className = 'mb-8 p-8 rounded-2xl shadow-2xl border-4 border-yellow-500 bg-yellow-900 bg-opacity-20';
        emoji.textContent = 'ğŸŸ¡';
        title.textContent = 'ä»Šæ—¥ã®çµè«–ï¼šæ…é‡ã«ãƒˆãƒ¬ãƒ¼ãƒ‰';
        reason.textContent = `ç†ç”±ï¼šæœŸå¾…å€¤ã¯æ­£ï¼ˆ${fmtJPY2(Math.round(expectancy))}ï¼‰ã ãŒä¸å®‰å®šè¦ç´ ã‚ã‚Š`;
        action.textContent = 'ğŸ‘‰ è¡Œå‹•ï¼šãƒ­ãƒƒãƒˆç¸®å°ï¼ä»¶æ•°åˆ¶é™ã‚’æ¨å¥¨';
      } else {
        // ğŸŸ¢ æ­£å¸¸é‹è»¢
        box.className = 'mb-8 p-8 rounded-2xl shadow-2xl border-4 border-green-500 bg-green-900 bg-opacity-20';
        emoji.textContent = 'ğŸŸ¢';
        title.textContent = 'ä»Šæ—¥ã®çµè«–ï¼šæ–°è¦ãƒˆãƒ¬ãƒ¼ãƒ‰OK';
        reason.textContent = `ç†ç”±ï¼šæœŸå¾…å€¤ãƒ—ãƒ©ã‚¹ï¼ˆ${fmtJPY2(Math.round(expectancy))}ï¼‰ãƒ»å®‰å®šç¨¼åƒä¸­`;
        action.textContent = 'ğŸ‘‰ è¡Œå‹•ï¼šç¶™ç¶šå¯';
      }
    }

    // ğŸš¦ æˆ¦ç•¥ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹åˆ¤å®šï¼ˆå…±é€šé–¢æ•°ï¼‰
    function judgeStatus(entries) {
      if (!entries || entries.length === 0) {
        return { emoji: 'âšª', label: 'ãƒ‡ãƒ¼ã‚¿ãªã—', color: 'gray', reason: 'å–å¼•ãƒ‡ãƒ¼ã‚¿ãŒã‚ã‚Šã¾ã›ã‚“', action: 'ãƒ‡ãƒ¼ã‚¿ã‚’è¿½åŠ ã—ã¦ãã ã•ã„' };
      }

      const totalPnL = entries.reduce((sum, e) => sum + (e.pnlJPY || 0), 0);
      const expectancy = totalPnL / entries.length;
      
      // æœ€å¤§DD
      let maxDD = 0;
      let cumulative = 0;
      let peak = 0;
      entries.forEach(e => {
        cumulative += e.pnlJPY || 0;
        if (cumulative > peak) peak = cumulative;
        const dd = peak - cumulative;
        if (dd > maxDD) maxDD = dd;
      });

      // æœ€å¤§é€£æ•—
      let maxLoseStreak = 0;
      let currentStreak = 0;
      entries.forEach(e => {
        if (e.pnlJPY < 0) {
          currentStreak++;
          if (currentStreak > maxLoseStreak) maxLoseStreak = currentStreak;
        } else {
          currentStreak = 0;
        }
      });
      
      // åˆ¤å®šãƒ­ã‚¸ãƒƒã‚¯ï¼ˆæœŸå¾…å€¤ã‚’æœ€å„ªå…ˆï¼‰
      // ğŸ”´ åœæ­¢æ¤œè¨ï¼šæœŸå¾…å€¤ãŒãƒã‚¤ãƒŠã‚¹
      if (expectancy < 0) {
        return { 
          emoji: 'ğŸ”´', 
          label: 'åœæ­¢æ¤œè¨', 
          color: 'red', 
          reason: `æœŸå¾…å€¤ãƒã‚¤ãƒŠã‚¹ï¼ˆ${fmtJPY2(Math.round(expectancy))}ï¼‰`,
          action: 'æ–°è¦ã‚¨ãƒ³ãƒˆãƒªãƒ¼ç¦æ­¢ï¼å¯¾è±¡å‰Šæ¸›'
        };
      }
      // ğŸŸ¡ æ³¨æ„ï¼šæœŸå¾…å€¤ã¯æ­£ã ãŒå°ã•ã„ã€ã¾ãŸã¯ä¸å®‰å®š
      else if (expectancy > 0 && expectancy < 500) {
        return { 
          emoji: 'ğŸŸ¡', 
          label: 'æ³¨æ„', 
          color: 'yellow', 
          reason: `æœŸå¾…å€¤ãŒä½ã„ï¼ˆ${fmtJPY2(Math.round(expectancy))}ï¼‰`,
          action: 'ãƒ­ãƒƒãƒˆç¸®å°ï¼ä»¶æ•°åˆ¶é™'
        };
      }
      // ğŸŸ¡ æ³¨æ„ï¼šæœŸå¾…å€¤ã¯è‰¯ã„ãŒé€£æ•—ã‚„DDãŒå¤§ãã„
      else if (expectancy >= 500 && (maxLoseStreak > 10 || maxDD > Math.abs(totalPnL * 0.5))) {
        return { 
          emoji: 'ğŸŸ¡', 
          label: 'æ³¨æ„', 
          color: 'yellow', 
          reason: 'æœŸå¾…å€¤ã¯æ­£ã ãŒä¸å®‰å®šè¦ç´ ã‚ã‚Š',
          action: 'ãƒ­ãƒƒãƒˆç¸®å°ï¼ãƒªã‚¹ã‚¯ç®¡ç†å¼·åŒ–'
        };
      }
      // ğŸŸ¢ æ­£å¸¸é‹è»¢ï¼šæœŸå¾…å€¤ãŒååˆ†ã«ãƒ—ãƒ©ã‚¹
      else {
        return { 
          emoji: 'ğŸŸ¢', 
          label: 'æ­£å¸¸é‹è»¢', 
          color: 'green', 
          reason: `æœŸå¾…å€¤ãƒ—ãƒ©ã‚¹ï¼ˆ${fmtJPY2(Math.round(expectancy))}ï¼‰ãƒ»å®‰å®šç¨¼åƒä¸­`,
          action: 'ç¶™ç¶šå¯'
        };
      }
    }

    // ğŸš¦ æˆ¦ç•¥ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹æç”»
    function renderStrategyStatus() {
      const filtered = getFilteredEntries();
      
      // å…¨ä½“ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹
      const overallStatus = judgeStatus(filtered);
      document.getElementById('overallEmoji').textContent = overallStatus.emoji;
      document.getElementById('overallLabel').textContent = overallStatus.label;
      document.getElementById('overallLabel').className = `text-3xl font-bold mb-2 text-${overallStatus.color}-500`;
      document.getElementById('overallReason').textContent = `ç†ç”±ï¼š${overallStatus.reason}`;
      document.getElementById('overallAction').textContent = `ğŸ‘‰ è¡Œå‹•ï¼š${overallStatus.action}`;
      document.getElementById('strategyStatusOverall').className = `bg-slate-800 p-8 rounded-2xl shadow-xl border-4 border-${overallStatus.color}-500`;

      // ã‚«ãƒ†ã‚´ãƒªåˆ¥ãƒ‡ãƒ¼ã‚¿é›†è¨ˆ
      const categoryData = {};
      filtered.forEach(e => {
        const cat = e.category || 'æœªåˆ†é¡';
        if (!categoryData[cat]) categoryData[cat] = [];
        categoryData[cat].push(e);
      });

      // ä¸»çŠ¯ã‚«ãƒ†ã‚´ãƒªæ¤œå‡ºï¼ˆæå¤±å¯„ä¸ç‡30%ä»¥ä¸Šï¼‹æœŸå¾…å€¤ãƒã‚¤ãƒŠã‚¹ï¼‰
      const totalLoss = Math.abs(filtered.filter(e => e.pnlJPY < 0).reduce((sum, e) => sum + e.pnlJPY, 0));
      const overallExpectancy = filtered.length > 0 ? filtered.reduce((sum, e) => sum + (e.pnlJPY || 0), 0) / filtered.length : 0;
      let culprit = null;
      Object.keys(categoryData).forEach(cat => {
        const catEntries = categoryData[cat];
        const catLoss = Math.abs(catEntries.filter(e => e.pnlJPY < 0).reduce((sum, e) => sum + e.pnlJPY, 0));
        const catTotalPnL = catEntries.reduce((sum, e) => sum + (e.pnlJPY || 0), 0);
        const catExpectancy = catTotalPnL / catEntries.length;
        const lossRatio = totalLoss > 0 ? (catLoss / totalLoss) * 100 : 0;
        
        // æœŸå¾…å€¤ãƒã‚¤ãƒŠã‚¹ï¼‹æå¤±å¯„ä¸ç‡30%ä»¥ä¸Šã‚’ä¸»çŠ¯ã¨ã™ã‚‹
        if (catExpectancy < 0 && lossRatio >= 30 && (!culprit || lossRatio > culprit.lossRatio)) {
          // ã“ã®ã‚«ãƒ†ã‚´ãƒªã‚’é™¤å¤–ã—ãŸå ´åˆã®æœŸå¾…å€¤ã‚’è¨ˆç®—
          const remainingEntries = filtered.filter(e => (e.category || 'æœªåˆ†é¡') !== cat);
          const newExpectancy = remainingEntries.length > 0 ? remainingEntries.reduce((sum, e) => sum + (e.pnlJPY || 0), 0) / remainingEntries.length : 0;
          const improvement = newExpectancy - overallExpectancy;
          
          culprit = { cat, lossRatio, catExpectancy, catTotalPnL, count: catEntries.length, improvement, newExpectancy };
        }
      });

      // ä¸»çŠ¯ã‚«ãƒ†ã‚´ãƒªè­¦å‘Šè¡¨ç¤º
      const culpritWarning = document.getElementById('culpritWarning');
      if (culprit) {
        culpritWarning.className = 'mb-4';
        document.getElementById('culpritContent').innerHTML = `
          <div class="flex items-center gap-6">
            <div class="text-7xl">âš ï¸</div>
            <div class="flex-1">
              <h4 class="text-2xl font-bold text-red-400 mb-2">${culprit.cat} ãŒä¸»çŠ¯</h4>
              <div class="grid grid-cols-2 gap-4 text-white">
                <div>
                  <p class="text-sm text-gray-400">å…¨ä½“æå¤±ã«å ã‚ã‚‹å‰²åˆ</p>
                  <p class="text-3xl font-bold text-red-400">${culprit.lossRatio.toFixed(1)}%</p>
                </div>
                <div>
                  <p class="text-sm text-gray-400">æœŸå¾…å€¤ï¼ˆ1å›ã‚ãŸã‚Šï¼‰</p>
                  <p class="text-3xl font-bold text-red-400">${fmtJPY2(Math.round(culprit.catExpectancy))}</p>
                </div>
                <div>
                  <p class="text-sm text-gray-400">ç·æç›Š</p>
                  <p class="text-2xl font-bold">${fmtJPY(culprit.catTotalPnL)}</p>
                </div>
                <div>
                  <p class="text-sm text-gray-400">ä»¶æ•°</p>
                  <p class="text-2xl font-bold">${culprit.count}ä»¶</p>
                </div>
              </div>
              <div class="mt-4 p-4 bg-yellow-900 bg-opacity-30 rounded-xl border-2 border-yellow-500">
                <p class="text-lg font-bold text-yellow-400 mb-2">ğŸ’¡ ${culprit.cat}ã‚’åœæ­¢ã—ãŸå ´åˆã®æ”¹å–„äºˆæ¸¬</p>
                <div class="grid grid-cols-2 gap-4">
                  <div>
                    <p class="text-sm text-gray-400">ç¾åœ¨ã®æœŸå¾…å€¤</p>
                    <p class="text-xl font-bold text-red-400">${fmtJPY2(Math.round(overallExpectancy))}</p>
                  </div>
                  <div>
                    <p class="text-sm text-gray-400">åœæ­¢å¾Œã®æœŸå¾…å€¤</p>
                    <p class="text-xl font-bold text-green-400">${fmtJPY2(Math.round(culprit.newExpectancy))}</p>
                  </div>
                </div>
                <p class="text-center text-2xl font-bold text-green-400 mt-2">ğŸ‘‰ æœŸå¾…å€¤ ${fmtJPY2(Math.round(culprit.improvement))} æ”¹å–„ï¼</p>
              </div>
            </div>
          </div>
        `;
      } else {
        culpritWarning.className = 'mb-4 hidden';
      }

      // ã‚«ãƒ†ã‚´ãƒªåˆ¥ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹
      const categoryDiv = document.getElementById('strategyStatusByCategory');
      categoryDiv.innerHTML = '';
      Object.keys(categoryData).sort().forEach(cat => {
        const status = judgeStatus(categoryData[cat]);
        const card = document.createElement('div');
        card.className = `bg-slate-800 p-2 rounded-md shadow-sm border border-${status.color}-500 text-center`;
        card.innerHTML = `
          <div class="text-xl mb-0.5">${status.emoji}</div>
          <div class="text-xs font-bold truncate" title="${cat}">${cat}</div>
          <div class="text-xs text-${status.color}-400 font-bold">${status.label}</div>
          <div class="text-xs text-gray-500 mt-0.5">${categoryData[cat].length}ä»¶</div>
        `;
        categoryDiv.appendChild(card);
      });
    }

    // åˆ†æã‚¿ãƒ–åˆ‡ã‚Šæ›¿ãˆ
    function setAnalysisTab(tab) {
      currentAnalysisTab = tab;
      ['category', 'symbol', 'broker', 'tradeType'].forEach(t => {
        const btn = document.getElementById(`tab-${t}`);
        if (t === tab) {
          btn.className = 'px-6 py-3 bg-gradient-to-r from-yellow-500 to-red-500 text-white rounded-xl shadow-lg font-bold';
        } else {
          btn.className = 'px-6 py-3 bg-slate-800 border-2 border-slate-700 rounded-xl hover:bg-slate-700 font-bold';
        }
      });
      renderAnalysis();
    }

    // ğŸ“Š åŸå› åˆ†æãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°
    function renderAnalysis() {
      const filtered = getFilteredEntries();
      const data = {};
      
      // å…¨ä½“ã®æå¤±åˆè¨ˆã‚’è¨ˆç®—ï¼ˆå¯„ä¸ç‡è¨ˆç®—ç”¨ï¼‰
      const totalLoss = Math.abs(filtered.filter(e => e.pnlJPY < 0).reduce((sum, e) => sum + e.pnlJPY, 0));
      
      // ãƒ‡ãƒ¼ã‚¿é›†è¨ˆ
      filtered.forEach(e => {
        let key;
        if (currentAnalysisTab === 'category') key = e.category || 'ãã®ä»–';
        else if (currentAnalysisTab === 'symbol') key = e.symbolCode || 'ãã®ä»–';
        else if (currentAnalysisTab === 'broker') key = e.brokerAccount || 'ãã®ä»–';
        else if (currentAnalysisTab === 'tradeType') key = e.tradeType || 'ãã®ä»–';
        
        if (!data[key]) {
          data[key] = { count: 0, totalPnL: 0, wins: 0, cumulative: 0, peak: 0, maxDD: 0, loss: 0 };
        }
        data[key].count++;
        data[key].totalPnL += e.pnlJPY || 0;
        if (e.pnlJPY > 0) data[key].wins++;
        if (e.pnlJPY < 0) data[key].loss += Math.abs(e.pnlJPY);
        
        // DDè¨ˆç®—
        data[key].cumulative += e.pnlJPY || 0;
        if (data[key].cumulative > data[key].peak) data[key].peak = data[key].cumulative;
        const dd = data[key].peak - data[key].cumulative;
        if (dd > data[key].maxDD) data[key].maxDD = dd;
      });

      // æœŸå¾…å€¤æ˜‡é †ã‚½ãƒ¼ãƒˆï¼ˆãƒã‚¤ãƒŠã‚¹ãŒä¸Šã«æ¥ã‚‹ï¼‰
      const sorted = Object.keys(data)
        .map(key => {
          const item = data[key];
          const expectancy = item.count > 0 ? item.totalPnL / item.count : 0;
          const lossRatio = totalLoss > 0 ? (item.loss / totalLoss) * 100 : 0;
          return { name: key, expectancy, lossRatio, ...item };
        })
        .sort((a, b) => a.expectancy - b.expectancy);

      // ä¸‹ä½20%ã‚’è¨ˆç®—
      const bottomThreshold = Math.ceil(sorted.length * 0.2);

      // ãƒ†ãƒ¼ãƒ–ãƒ«ç”Ÿæˆ
      const tbody = document.getElementById('analysisTableBody');
      tbody.innerHTML = sorted.map((item, index) => {
        const { name, count, totalPnL, wins, maxDD, expectancy, lossRatio } = item;
        const winRate = count > 0 ? (wins / count * 100).toFixed(1) : 0;
        
        // åœæ­¢å€™è£œã®åˆ¤å®šï¼šæœŸå¾…å€¤ãŒãƒã‚¤ãƒŠã‚¹ã€ã¾ãŸã¯ä¸‹ä½20%
        const isBottom = index < bottomThreshold || expectancy < 0;
        
        return `
          <tr class="${isBottom ? 'bg-red-900 bg-opacity-40 border-2 border-red-600' : 'hover:bg-slate-700'} border-b border-slate-600">
            <td class="px-4 py-3 font-bold">
              ${name} 
              ${isBottom ? '<span class="ml-2 px-2 py-1 bg-red-600 rounded text-xs">âŒ åœæ­¢å€™è£œ</span>' : ''}
            </td>
            <td class="px-4 py-3 text-right">${count}ä»¶</td>
            <td class="px-4 py-3 text-right ${totalPnL >= 0 ? 'text-green-400' : 'text-red-400'} font-bold">${fmtJPY(totalPnL)}</td>
            <td class="px-4 py-3 text-right ${expectancy >= 0 ? 'text-green-400' : 'text-red-400'} font-bold">${fmtJPY2(Math.round(expectancy))}</td>
            <td class="px-4 py-3 text-right">${winRate}%</td>
            <td class="px-4 py-3 text-right text-red-400">${fmtJPY2(Math.round(-maxDD))}</td>
            <td class="px-4 py-3 text-right ${lossRatio >= 30 ? 'text-red-400 font-bold' : 'text-gray-400'}">${lossRatio.toFixed(1)}%</td>
          </tr>
        `;
      }).join('');

      // å‰Šæ¸›ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ç”¨ãƒã‚§ãƒƒã‚¯ãƒœãƒƒã‚¯ã‚¹ç”Ÿæˆï¼ˆã‚«ãƒ†ã‚´ãƒªã‚¿ãƒ–ã®ã¿ï¼‰
      if (currentAnalysisTab === 'category') {
        renderSimulationCheckboxes(sorted);
      }
    }

    // ğŸ¯ å‰Šæ¸›ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ï¼šãƒã‚§ãƒƒã‚¯ãƒœãƒƒã‚¯ã‚¹ç”Ÿæˆ
    function renderSimulationCheckboxes(categories) {
      const checkboxDiv = document.getElementById('simulationCheckboxes');
      checkboxDiv.innerHTML = categories.map(cat => `
        <label class="flex items-center gap-2 px-4 py-2 bg-slate-700 rounded-lg cursor-pointer hover:bg-slate-600">
          <input type="checkbox" value="${cat.name}" onchange="runSimulation()" class="simulation-checkbox w-4 h-4">
          <span>${cat.name}</span>
        </label>
      `).join('');
    }

    // ğŸ¯ å‰Šæ¸›ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³å®Ÿè¡Œ
    function runSimulation() {
      const checkboxes = document.querySelectorAll('.simulation-checkbox:checked');
      const excludeCategories = Array.from(checkboxes).map(cb => cb.value);
      
      if (excludeCategories.length === 0) {
        document.getElementById('simulationResult').className = 'grid grid-cols-3 gap-4 mt-4 hidden';
        return;
      }

      // é™¤å¤–å¾Œã®ãƒ‡ãƒ¼ã‚¿ã‚’è¨ˆç®—
      const filtered = getFilteredEntries();
      const remaining = filtered.filter(e => !excludeCategories.includes(e.category || 'ãã®ä»–'));
      
      if (remaining.length === 0) {
        document.getElementById('simulationResult').className = 'grid grid-cols-3 gap-4 mt-4';
        document.getElementById('simExpectancy').textContent = 'ãƒ‡ãƒ¼ã‚¿ãªã—';
        document.getElementById('simMaxDD').textContent = 'ãƒ‡ãƒ¼ã‚¿ãªã—';
        document.getElementById('simPF').textContent = 'ãƒ‡ãƒ¼ã‚¿ãªã—';
        return;
      }

      // æœŸå¾…å€¤
      const totalPnL = remaining.reduce((sum, e) => sum + (e.pnlJPY || 0), 0);
      const expectancy = totalPnL / remaining.length;
      const originalExpectancy = filtered.length > 0 ? filtered.reduce((sum, e) => sum + (e.pnlJPY || 0), 0) / filtered.length : 0;

      // æœ€å¤§DD
      let maxDD = 0;
      let cumulative = 0;
      let peak = 0;
      remaining.forEach(e => {
        cumulative += e.pnlJPY || 0;
        if (cumulative > peak) peak = cumulative;
        const dd = peak - cumulative;
        if (dd > maxDD) maxDD = dd;
      });
      let originalMaxDD = 0;
      let originalCumulative = 0;
      let originalPeak = 0;
      filtered.forEach(e => {
        originalCumulative += e.pnlJPY || 0;
        if (originalCumulative > originalPeak) originalPeak = originalCumulative;
        const dd = originalPeak - originalCumulative;
        if (dd > originalMaxDD) originalMaxDD = dd;
      });

      // PF
      const totalWins = remaining.filter(e => e.pnlJPY > 0).reduce((sum, e) => sum + e.pnlJPY, 0);
      const totalLosses = Math.abs(remaining.filter(e => e.pnlJPY < 0).reduce((sum, e) => sum + e.pnlJPY, 0));
      const pf = totalLosses > 0 ? totalWins / totalLosses : 0;
      const originalTotalWins = filtered.filter(e => e.pnlJPY > 0).reduce((sum, e) => sum + e.pnlJPY, 0);
      const originalTotalLosses = Math.abs(filtered.filter(e => e.pnlJPY < 0).reduce((sum, e) => sum + e.pnlJPY, 0));
      const originalPF = originalTotalLosses > 0 ? originalTotalWins / originalTotalLosses : 0;

      // è¡¨ç¤º
      document.getElementById('simulationResult').className = 'grid grid-cols-3 gap-4 mt-4';
      document.getElementById('simExpectancy').textContent = `${fmtJPY2(Math.round(expectancy))} (${expectancy > originalExpectancy ? '+' : ''}${fmtJPY2(Math.round(expectancy - originalExpectancy))})`;
      document.getElementById('simExpectancy').className = `text-2xl font-bold ${expectancy > originalExpectancy ? 'text-green-400' : 'text-red-400'}`;
      document.getElementById('simMaxDD').textContent = `${fmtJPY2(Math.round(-maxDD))} (${-maxDD > -originalMaxDD ? '+' : ''}${fmtJPY2(Math.round(-maxDD - (-originalMaxDD)))})`;
      document.getElementById('simMaxDD').className = `text-2xl font-bold ${maxDD < originalMaxDD ? 'text-green-400' : 'text-red-400'}`;
      document.getElementById('simPF').textContent = `${pf.toFixed(2)} (${pf > originalPF ? '+' : ''}${(pf - originalPF).toFixed(2)})`;
      document.getElementById('simPF').className = `text-2xl font-bold ${pf > originalPF ? 'text-green-400' : 'text-red-400'}`;
    }

    // ğŸ“ˆ ã‚°ãƒ©ãƒ•ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°
    function renderCharts() {
      renderMonthlyChart();
      renderCumulativeChart();
      renderDrawdownChart();
    }

    // æœˆæ¬¡æ¨ç§»ã‚°ãƒ©ãƒ•
    function renderMonthlyChart() {
      const filtered = getFilteredEntries();
      if (filtered.length === 0) return;
      
      const monthlyData = {};
      filtered.forEach(e => {
        const month = e.date.substring(0, 7);
        if (!monthlyData[month]) monthlyData[month] = 0;
        monthlyData[month] += e.pnlJPY || 0;
      });

      const labels = Object.keys(monthlyData).sort();
      const data = labels.map(m => monthlyData[m]);

      const ctx = document.getElementById('monthlyChart').getContext('2d');
      if (window.monthlyChartInstance) window.monthlyChartInstance.destroy();
      window.monthlyChartInstance = new Chart(ctx, {
        type: 'bar',
        data: {
          labels: labels,
          datasets: [{
            label: 'æœˆæ¬¡æç›Š',
            data: data,
            backgroundColor: data.map(v => v >= 0 ? 'rgba(34, 197, 94, 0.8)' : 'rgba(239, 68, 68, 0.8)')
          }]
        },
        options: {
          responsive: true,
          maintainAspectRatio: true,
          scales: {
            y: {
              beginAtZero: true,
              ticks: { 
                color: '#fff',
                callback: function(value) {
                  return 'Â¥' + Math.round(value).toLocaleString('ja-JP');
                }
              }
            },
            x: { 
              ticks: { color: '#fff' }
            }
          },
          barPercentage: 0.7,
          categoryPercentage: 0.8,
          plugins: {
            legend: { labels: { color: '#fff' } },
            tooltip: {
              callbacks: {
                label: function(context) {
                  return 'æœˆæ¬¡æç›Š: Â¥' + Math.round(context.parsed.y).toLocaleString('ja-JP');
                }
              }
            }
          }
        }
      });
    }

    // ç´¯ç©æç›Šã‚°ãƒ©ãƒ•ï¼ˆPeak/Troughè¿½åŠ ç‰ˆï¼‰
    function renderCumulativeChart() {
      const filtered = getFilteredEntries();
      if (filtered.length === 0) return;
      
      // æ—¥ä»˜é †ã«ä¸¦ã³æ›¿ãˆï¼ˆå¤ã„é †ï¼‰
      const sorted = [...filtered].sort((a, b) => a.date.localeCompare(b.date));
      
      let cumulative = 0;
      let peak = 0;
      let peakIndex = -1;
      let troughValue = 0;
      let troughIndex = -1;
      const labels = [];
      const data = [];
      const peakData = [];
      const troughData = [];
      
      sorted.forEach((e, i) => {
        cumulative += e.pnlJPY || 0;
        labels.push(e.date);
        data.push(cumulative);
        
        // Peakæ¤œå‡º
        if (cumulative > peak) {
          peak = cumulative;
          peakIndex = i;
        }
        
        // Troughæ¤œå‡ºï¼ˆPeakã‹ã‚‰æœ€ã‚‚ä¸‹è½ã—ãŸç‚¹ï¼‰
        const currentDD = peak - cumulative;
        if (peakIndex >= 0 && currentDD > (peak - troughValue)) {
          troughValue = cumulative;
          troughIndex = i;
        }
        
        // Peak/Troughãƒ‡ãƒ¼ã‚¿ç”Ÿæˆ
        peakData.push(i === peakIndex ? cumulative : null);
        troughData.push(i === troughIndex ? cumulative : null);
      });

      const ctx = document.getElementById('cumulativeChart').getContext('2d');
      if (window.cumulativeChartInstance) window.cumulativeChartInstance.destroy();
      window.cumulativeChartInstance = new Chart(ctx, {
        type: 'line',
        data: {
          labels: labels,
          datasets: [
            {
              label: 'ç´¯ç©æç›Š',
              data: data,
              borderColor: 'rgba(59, 130, 246, 1)',
              backgroundColor: 'rgba(59, 130, 246, 0.1)',
              fill: true,
              tension: 0.1,
              pointRadius: 0
            }
          ]
        },
        options: {
          responsive: true,
          maintainAspectRatio: true,
          scales: {
            y: { 
              beginAtZero: true,
              ticks: { 
                color: '#fff',
                callback: function(value) {
                  return 'Â¥' + Math.round(value).toLocaleString('ja-JP');
                }
              }
            },
            x: { 
              ticks: { 
                color: '#fff',
                maxTicksLimit: 10
              }
            }
          },
          plugins: {
            legend: { labels: { color: '#fff' } },
            tooltip: {
              callbacks: {
                label: function(context) {
                  return context.dataset.label + ': Â¥' + Math.round(context.parsed.y).toLocaleString('ja-JP');
                }
              }
            }
          }
        }
      });
    }
    
    // ğŸ“‰ ãƒ‰ãƒ­ãƒ¼ãƒ€ã‚¦ãƒ³æ¨ç§»ã‚°ãƒ©ãƒ•ï¼ˆæ–°è¦é–¢æ•°ï¼‰
    function renderDrawdownChart() {
      const filtered = getFilteredEntries();
      if (filtered.length === 0) return;
      
      // æ—¥ä»˜é †ã«ä¸¦ã³æ›¿ãˆï¼ˆå¤ã„é †ï¼‰
      const sorted = [...filtered].sort((a, b) => a.date.localeCompare(b.date));
      
      let cumulative = 0;
      let peak = 0;
      const labels = [];
      const ddData = [];
      
      sorted.forEach(e => {
        cumulative += e.pnlJPY || 0;
        if (cumulative > peak) peak = cumulative;
        const dd = peak - cumulative; // DDï¼ˆå¸¸ã«0ä»¥ä¸Šï¼‰
        labels.push(e.date);
        ddData.push(-dd); // ãƒã‚¤ãƒŠã‚¹è¡¨ç¤ºï¼ˆä¸‹ã«ä¼¸ã³ã‚‹ï¼‰
      });
      
      const ctx = document.getElementById('drawdownChart').getContext('2d');
      if (window.drawdownChartInstance) window.drawdownChartInstance.destroy();
      window.drawdownChartInstance = new Chart(ctx, {
        type: 'line',
        data: {
          labels: labels,
          datasets: [{
            label: 'ãƒ‰ãƒ­ãƒ¼ãƒ€ã‚¦ãƒ³',
            data: ddData,
            borderColor: 'rgba(239, 68, 68, 1)',
            backgroundColor: 'rgba(239, 68, 68, 0.2)',
            fill: true,
            tension: 0.1,
            pointRadius: 0
          }]
        },
        options: {
          responsive: true,
          maintainAspectRatio: true,
          scales: {
            y: { 
              max: 0,
              ticks: { 
                color: '#fff',
                callback: function(value) {
                  return 'Â¥' + Math.round(value).toLocaleString('ja-JP');
                }
              }
            },
            x: { 
              ticks: { 
                color: '#fff',
                maxTicksLimit: 10
              }
            }
          },
          plugins: {
            legend: { labels: { color: '#fff' } },
            tooltip: {
              callbacks: {
                label: function(context) {
                  return 'DD: Â¥' + Math.round(context.parsed.y).toLocaleString('ja-JP');
                }
              }
            }
          }
        }
      });
    }

    // ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆé–¢æ•°
    function fmtJPY(n) {
      return `${n >= 0 ? '+' : ''}${Math.round(n).toLocaleString('ja-JP')}å††`;
    }

    function fmtJPY2(n) {
      return `Â¥${Math.round(n).toLocaleString('ja-JP')}`;
    }

    function fmtUSDT(n) {
      const sign = n >= 0 ? '+' : '';
      return `${sign}${Number(n).toLocaleString('en-US', { minimumFractionDigits: 2, maximumFractionDigits: 2 })} USDT`;
    }

    // åˆæœŸåŒ–å®Ÿè¡Œ
    init();
  </script>
</body>
</html>
